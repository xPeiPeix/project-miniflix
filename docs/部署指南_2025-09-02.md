# ğŸš€ Project Miniflix éƒ¨ç½²æŒ‡å—

> **é¢å‘å¼€å‘è€…**: ä»GitHubå…‹éš†é¡¹ç›®åçš„å®Œæ•´éƒ¨ç½²æµç¨‹  
> **æ›´æ–°æ—¥æœŸ**: 2025-09-02

---

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

- **Python 3.7+**
- **FFmpeg & FFprobe** (ç³»ç»Ÿçº§å®‰è£…)
- **Nginx** (æ¨è)
- **Linux/macOS** (æ¨èï¼ŒWindowséœ€è¦é¢å¤–é…ç½®)

---

## ğŸ”§ å¿«é€Ÿéƒ¨ç½²

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/your-username/project-miniflix.git
cd project-miniflix
```

### 2. å®‰è£…ç³»ç»Ÿä¾èµ–
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install ffmpeg nginx python3-pip

# CentOS/RHEL
sudo yum install epel-release
sudo yum install ffmpeg nginx python3-pip

# macOS
brew install ffmpeg nginx python3
```

### 3. å®‰è£…Pythonä¾èµ–
```bash
pip3 install -r auto_processor_requirements.txt
```

### 4. åˆ›å»ºå¿…è¦ç›®å½•
```bash
mkdir -p videos thumbnails hls_videos_optimized logs backup
```

### 5. é…ç½®ç³»ç»ŸæœåŠ¡
```bash
# ä¿®æ”¹æœåŠ¡é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„
sed -i 's|/home/peipei/show_media|'$(pwd)'|g' auto_processor.service
sed -i 's|User=peipei|User='$(whoami)'|g' auto_processor.service
sed -i 's|Group=peipei|Group='$(whoami)'|g' auto_processor.service

# å®‰è£…ç³»ç»ŸæœåŠ¡
sudo cp auto_processor.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable auto_processor
```

### 6. é…ç½®Nginx
```bash
# ä¿®æ”¹Nginxé…ç½®ä¸­çš„è·¯å¾„
sed -i 's|/path/to/your/project-miniflix|'$(pwd)'|g' nginx.conf.example
cp nginx.conf.example nginx.conf

# å®‰è£…Nginxé…ç½®
sudo cp nginx.conf /etc/nginx/sites-available/miniflix
sudo ln -s /etc/nginx/sites-available/miniflix /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t
```

### 7. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨è§†é¢‘å¤„ç†æœåŠ¡
sudo systemctl start auto_processor

# å¯åŠ¨Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

---

## ğŸ¬ æ·»åŠ è§†é¢‘

### ä¸Šä¼ è§†é¢‘æ–‡ä»¶
```bash
# å°†ä½ çš„è§†é¢‘æ–‡ä»¶æ”¾å…¥videosç›®å½•
cp your-video.mp4 videos/
```

### ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹æ–°è§†é¢‘æ–‡ä»¶
2. è½¬æ¢ä¸ºHLSæ ¼å¼
3. ç”Ÿæˆç¼©ç•¥å›¾
4. æ›´æ–°è§†é¢‘æ•°æ®åº“
5. åœ¨ç½‘ç«™ä¸Šæ˜¾ç¤º

---

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹å¤„ç†ç³»ç»ŸçŠ¶æ€
python3 run_auto_processor.py --status

# æ‰‹åŠ¨æ‰«æå¤„ç†ç°æœ‰è§†é¢‘
python3 run_auto_processor.py --scan-only

# æµ‹è¯•æ¨¡å¼è¿è¡Œ
python3 run_auto_processor.py --test

# åœæ­¢æœåŠ¡
sudo systemctl stop auto_processor
```

---

## ğŸŒ è®¿é—®ç½‘ç«™

- **æœ¬åœ°è®¿é—®**: http://localhost
- **å±€åŸŸç½‘è®¿é—®**: http://ä½ çš„æœåŠ¡å™¨IP
- **è‡ªå®šä¹‰ç«¯å£**: ä¿®æ”¹nginx.confä¸­çš„`listen`æŒ‡ä»¤

---

## âš™ï¸ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹è§†é¢‘å¤„ç†å‚æ•°
ç¼–è¾‘ `auto_processor/config.py`:
```python
"video_processing": {
    "segment_time": 3,      # HLSåˆ†ç‰‡æ—¶é•¿(ç§’)
    "crf": 23,             # è§†é¢‘è´¨é‡(18-28ï¼Œè¶Šå°è´¨é‡è¶Šé«˜)
    "maxrate": "1500k"     # æœ€å¤§ç ç‡
}
```

### ä¿®æ”¹WebæœåŠ¡ç«¯å£
ç¼–è¾‘ `nginx.conf`:
```nginx
server {
    listen 8080;  # æ”¹ä¸ºä½ éœ€è¦çš„ç«¯å£
    # ...
}
```

### è‡ªå®šä¹‰è§†é¢‘ä¿¡æ¯
- ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆè§†é¢‘æ ‡é¢˜å’Œæè¿°
- ä½ å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ `videos.json` æ–‡ä»¶è‡ªå®šä¹‰å†…å®¹
- ç³»ç»Ÿä¼šä¿æŠ¤ä½ çš„æ‰‹åŠ¨ä¿®æ”¹ï¼Œä¸ä¼šè¢«è¦†ç›–

---

## ğŸ› æ•…éšœæ’é™¤

### è§†é¢‘å¤„ç†å¤±è´¥
```bash
# æ£€æŸ¥FFmpegæ˜¯å¦æ­£ç¡®å®‰è£…
ffmpeg -version

# æŸ¥çœ‹å¤„ç†æ—¥å¿—
tail -f logs/auto_processor/*.log
```

### ç½‘ç«™æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥NginxçŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status auto_processor

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u auto_processor -f
```

---

## ğŸ“š é¡¹ç›®ç»“æ„

```
project-miniflix/
â”œâ”€â”€ ğŸŒ å‰ç«¯æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html              # è§†é¢‘ç”»å»Šä¸»é¡µ
â”‚   â”œâ”€â”€ player.html             # è§†é¢‘æ’­æ”¾é¡µé¢
â”‚   â”œâ”€â”€ css/style.css           # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ js/                     # JavaScripté€»è¾‘
â”‚   â””â”€â”€ lib/hls.min.js          # HLSæ’­æ”¾å™¨åº“
â”‚
â”œâ”€â”€ ğŸ¤– è‡ªåŠ¨å¤„ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ auto_processor/         # æ ¸å¿ƒå¤„ç†æ¨¡å—
â”‚   â””â”€â”€ run_auto_processor.py   # å¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ âš™ï¸ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ auto_processor.service  # ç³»ç»ŸæœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ nginx.conf.example      # Nginxé…ç½®æ¨¡æ¿
â”‚   â””â”€â”€ videos.json.example     # è§†é¢‘æ•°æ®ç¤ºä¾‹
â”‚
â””â”€â”€ ğŸ“ æ•°æ®ç›®å½• (è¿è¡Œæ—¶åˆ›å»º)
    â”œâ”€â”€ videos/                 # ä½ çš„è§†é¢‘æ–‡ä»¶
    â”œâ”€â”€ hls_videos_optimized/   # è½¬ç åçš„HLSæ–‡ä»¶
    â”œâ”€â”€ thumbnails/             # è§†é¢‘ç¼©ç•¥å›¾
    â”œâ”€â”€ videos.json             # è§†é¢‘æ•°æ®åº“
    â””â”€â”€ logs/                   # ç³»ç»Ÿæ—¥å¿—
```

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥

- [ ] ç³»ç»ŸæœåŠ¡æ­£å¸¸è¿è¡Œ (`systemctl status auto_processor`)
- [ ] NginxæœåŠ¡æ­£å¸¸è¿è¡Œ (`systemctl status nginx`)
- [ ] ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] ä¸Šä¼ æµ‹è¯•è§†é¢‘èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†
- [ ] è§†é¢‘å¯ä»¥æ­£å¸¸æ’­æ”¾

---

**ğŸ‰ æ­å–œï¼ä½ çš„Project Miniflixå·²ç»éƒ¨ç½²å®Œæˆï¼**

ç°åœ¨ä½ å¯ä»¥å¼€å§‹ä¸Šä¼ è§†é¢‘ï¼Œäº«å—è‡ªåŠ¨åŒ–çš„è§†é¢‘æµåª’ä½“æœåŠ¡äº†ï¼
